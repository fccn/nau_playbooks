<clickhouse>
    <remote_servers>
        <logs_cluster>
            <shard>
                <!--  internal_replication=true: writes go to ONE replica; CH replication propagates  -->
                <internal_replication>true</internal_replication>
{% for ch_host in clickhouse_cluster_hosts %}
                <replica>
                    <!--  NOTE: This hosts need to be correctly set  -->
                    <host>{{ hostvars[ch_host]['clickhouse_host'] | default(hostvars[ch_host]['ansible_host']) | default(ch_host) }}</host>
                    <port>{{ hostvars[ch_host]['clickhouse_server_tcp_port'] | default(clickhouse_server_tcp_port_default) }}</port>
                    <user>{{ hostvars[ch_host]['clickhouse_user'] | default(clickhouse_user) }}</user>
                    <password>{{ hostvars[ch_host]['clickhouse_password'] | default(clickhouse_password) }}</password>
                </replica>
{% endfor %}
            </shard>
        </logs_cluster>
    </remote_servers>
    <!--  We use keeper, but the ClickHouse config expects a ZooKeeper section. We point it to the keeper clients  -->
    <zookeeper>
{% for ch_host in clickhouse_cluster_hosts %}
        <node>
            <host>{{ hostvars[ch_host]['clickhouse_host'] | default(hostvars[ch_host]['ansible_host']) | default(ch_host) }}</host>
            <port>{{ hostvars[ch_host]['clickhouse_zookeeper_port'] | default(clickhouse_zookeeper_port_default) }}</port>
        </node>
{% endfor %}
    </zookeeper>
</clickhouse>
